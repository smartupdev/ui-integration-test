<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>poc-ui-test</title>
  <style>
    p{
      margin-left: 20px;
    }
  </style>
</head>
<body>

  <h3>MateMask测试</h3>

  <p><button id="connectMateMaskBtn">连接MateMask</button></p>
  <p>连接网络：<span id="netId"></span></p>
  <p>公钥地址：<span id="publicKey"></span></p>

  <br>

  <p><button id="getBalance">查询余额</button></p>
  <p>以太坊余额：<span id="ethBalance"></span></p>

  <br>

  <p><button id="transaction">测试给自己转账</button></p>

  <br>

  <p>签名</p>
  <p> <input id="signText" type="text" placeholder="需要签名的数据"/> <button id="signature">签名</button></p>


  <br><br><br>

  <h3>合约测试</h3>

  <h5>需要先连接metamask</h5>

  <p><button id="balanceOf">查询SUT</button></p>

  <p><button id="nttBalanceOf">查询NTT</button></p>

  <p><button id="createMarket">创建市场</button></p>

  <p><input id="marketIndexInput" type="text" placeholder="市场索引"/> <button id="getMarketByIndex">索引查询市场</button></p>


  <h5>市场</h5>

  <p>
    <input id="marketAddressInput" type="text" value=""/>
    <button id="setMarketAddress">设置市场地址</button>
  </p>

  <p><button id="getCreator">查询市场创建者地址</button></p>

  <p><button id="getTotalTradeSut">查询市场总交易SUT</button></p>

  <p><button id="getCtBalance">CT余额查询</button></p>

  <p><button id="getCtTotalSupply">CT发行量查询</button></p>

  <h5>交易</h5>

  <p>
    <input id="bidQuoteInput" type="number" placeholder="CT数量"/>
    <button id="getBidQuote">查询买入价格[SUT]</button>
  </p>

  <p>
    <input id="askQuoteInput" type="number" placeholder="CT数量"/>
    <button id="getAskQuote">查询卖出价格[SUT]</button>
  </p>

  <p>
    <input id="bidPriceInput" type="number" placeholder="CT查询价格"/>
    <input id="bidAmountInput" type="number" placeholder="CT数量"/>
    <button id="bidCt">买入CT</button>
  </p>

  <p>
    <input id="askInput" type="number" placeholder="CT数量"/>
    <button id="askCt">卖出CT</button>
  </p>



  <h5>争议</h5>

  <p><button id="marketState">市场状态</button></p>

  <p><button id="nextFlaggableDate">允许下次争议开始时间</button></p>

  <p>
    <input id="disputeAmount" type="number" placeholder="SUT数量"/>
    <button id="createDispute">发起争议</button>
  </p>

  <p><button id="flaggingPeriod">本次争议的开始结束时间</button></p>

  <p><button id="getDisputeCount">查询争议人数</button></p>

  <p><button id="getDisputeAmount">查询争议池金额</button></p>

  <p><button id="getDisputeAddresses">参与争议的地址</button></p>

  <p><button id="disputeDone">* 争议流产</button></p>

  <p><b>陪审员投票</b></p>

  <p><button id="flagVotingPeriod">投票的开始和结束时间</button></p>

  <p>
    <select id="disputeVote">
      <option value="true">解散</option>
      <option value="false">不解散</option>
    </select>
    <button id="jurorVote">陪审员投票(需要切换陪审员用户)</button>
  </p>

  <p><button id="getJurorSize">陪审员人数</button></p>

  <p><button id="getJurorList">陪审员列表</button></p>

  <p><button id="getJurorVotes">陪审员投票</button></p>

  <p><button id="jurorVoteDone">* 投票完结</button></p>

  <p><b>上诉</b></p>

  <p><button id="appealRound">已投票次数 (最多3次)</button></p>

  <p><button id="appealingPeriod">允许上诉的时间周期</button></p>

  <p><button id="doAppeal">* 上诉 (需要2500SUT，需要市场创建者发起掉用)</button></p>

  <p><button id="marketDissolve">* 解散市场</button></p>


  <h5>提案</h5>

  <p>
    <input id="proposedAmount" type="number" placeholder="提案金额SUT"/>
    <button id="doProposed">发起提案</button>
  </p>

  <p><button id="getCurrentProposedAmount">当前提案金额</button></p>

  <p><button id="getProposedAmount">总提案金额</button></p>

  <p>提案投票</p>

  <p><button id="proposedVotingPeriod">投票时间</button></p>

  <p>
    <select id="proposedVote">
      <option value="true">同意</option>
      <option value="false">反对</option>
    </select>
    <button id="doProposedVote">投票(需要切换陪审员用户)</button>
  </p>

  <p><button id="getProposedJurors">陪审员地址</button></p>

  <p><button id="getProposedVote">陪审员投票</button></p>

  <p><button id="proposedVoteDone">* 完结投票</button></p>

  <h5>内容提案</h5>

  <p>
    <input id="choiceNum" type="text" value=""/>
    <input id="validTime" type="text" value=""/>
    <button id="propose">发起内容提案(选项：2-5，有效期: 3(3min)，5(5min)，7(7min))</button>
  </p>

  <h5>内容提案投票</h5>

  <p>
    <input id="mychoice" type="text" value=""/>
    <input id="ctAmount" type="text" value=""/>
    <input id="_proposalId" type="text" value=""/>
    <button id="voteForProposal">为内容提案投票(选项，CT数量，内容投票ID)</button>
  </p>

  <h5>内容提案到期，撤回Ct</h5>
  <p>
    <input id="proposalId" type="text" value=""/>
    <button id="withdrawProposalCt">投票时间截止为内容提案ID撤回Ct(内容提案ID)</button>
  </p>

  <h5>查询内容提案详情</h5>

  <p>
    <input id="proposalId_" type="text" value=""/>
    <button id="getProposal">获取Ct市场内容提案的信息</button>
  </p>

  <br><br><br>

  <h3>查询交易</h3>
  <p>
    <select id="transactionType">
      <option value = "1">正常交易</option>
      <option value = "2">创建市场交易</option>
      <option value = "3">买入ct交易</option>
      <option value = "4">卖出ct交易</option>
    </select>
    <input id="transactionHash" type="text" value=""/>
    <button id="getTransactionDetails">获取交易信息</button>
  </p>

  <h5>IPFS测试</h5>

  <textarea id="jsonStr"></textarea>
  <p><button id="postIpfsJson">写入字符串，见console</button></p>

  <br>

  <p><input id="ipfsFileHash" placeholder="字符串hash"/></p>
  <p><button id="getIpfsFile">获取字符串，见console</button></p>

  <br>

  <p><input id="img" type="file"/></p>
  <p><button id="postIpfsImg">写入图片，见console</button></p>

  <br/><br/><br/>


  <h3>平台升级</h3>

  <h5>充值/提现</h5>

  <p>
    <input id="chargeSutInput" type="number" placeholder="SUT数量"/>
    <button id="chargeSutBtn">充值SUT</button>
  </p>

  <p>
    <input id="chargeEthInput" type="number" placeholder="ETH数量"/>
    <button id="chargeEthBtn">充值ETH</button>
  </p>

  <p>
    <input id="withdrawSutInput" type="number" placeholder="SUT数量"/>
    <button id="withdrawSutBtn">提取SUT</button>
  </p>

  <p>
    <input id="withdrawEthInput" type="number" placeholder="ETH数量"/>
    <button id="withdrawEthBtn">提取ETH</button>
  </p>

  <p>
    <button id="querySutInPlatform">查询存入的SUT</button>
  </p>

  <p>
    <button id="queryEthInPlatform">查询存入的ETH</button>
  </p>


  <h5>创建市场</h5>

  <p><b>签名方式</b></p>

  <p>1. gas fee 计算方式</p>
  <p>gasFee = gasPrice * gasLimit</p>
  <p>gasLimit代表合约执行的“步骤”，在确定执行的参数后，见合约文档，每次合约更新该值会更新</p>
  <p>gasPrice代表每“步骤”的花费，可以设置不同的档位，来决定交易的速度，例如 (5gwei 10gwei 20gwei)</p>
  <p>(1ether = 1 * 10^9 gwei , 1gwei = 1 * 10^9 wei)</p>
  <br/>

  <p>2. hash</p>
  <p>按照顺序对如下的数据做 userAddress, sut, marketId, marketId, ctCount, ctPrice, ctRecyclePrice, gasFee </p>
  <p>需要注意</p>
  <p>a) 所有数字都是以wei为单位，再转为字符串，最后toBN()</p>
  <p>b) marketId出现了两次</p>
  <p>let hash = web3.utils.soliditySha3(userAddress, web3.utils.toBN(sut), marketId, marketId, web3.utils.toBN(ctCount), web3.utils.toBN(ctPrice), web3.utils.toBN(ctRecyclePrice), web3.utils.toBN(gasFee))</p>
  <br/>

  <p>3.签名</p>
  <p>直接使用签名方法，签名hash即可</p>
  <p>let sign = web3.personal.sign(hash, userAddress)</p>
  <br/>

  <p><b>签名</b></p>
  <p><input id="gl_sut" placeholder="sut"></p>
  <p><input id="gl_marketId" placeholder="marketId"></p>
  <p><input id="gl_marketSymbol" placeholder="marketSymbol"></p>
  <p><input id="gl_ctCount" placeholder="ctCount"></p>
  <p><input id="gl_ctPrice" placeholder="ctPrice"></p>
  <p><input id="gl_ctRecyclePrice" placeholder="ctRecyclePrice"></p>
  <p><input id="gl_closingTime" placeholder="closingTime"></p>
  <p><input id="gl_gasLimit" placeholder="gasLimit"></p>
  <p><input id="gl_gasPrice" placeholder="gasPrice"></p>
  <p><button id="createMarketSign">签名</button></p>

  <h5>查询市场信息</h5>
  <p><input id="marketAddress" type="text" placeholder="marketAddress"></p>
  <p><button id="queryMarketBalance">第一阶段剩余CT</button></p>
  <p><button id="queryCtPrice">查询第一阶段买入价格</button></p>
  <p><button id="queryCtRecyclePrice">查询回收价格</button></p>
  <p><button id="queryMyCtCount">我的CT数量</button></p>
  <p><button id="queryMarketStage">查询市场阶段</button></p>

  <h5>第一阶段买CT</h5>
  <p><b>签名</b></p>
  <p><input id="fb_marketAddress" type="text" placeholder="marketAddress"></p>
  <p><input id="fb_userAddress" type="text" placeholder="userAddress"></p>
  <p><input id="fb_ctCount" type="text" placeholder="ctCount"></p>
  <p><input id="fb_gasLimit" type="text" placeholder="gasLimit"></p>
  <p><input id="fb_gasPrice" type="text" placeholder="gasPrice"></p>
  <p><input id="fb_time" type="text" placeholder="timestamp"></p>
  <p><button id="firstStageBuy">签名</button></p>


  <br/><br/><br/>
  <br/><br/><br/>
  <br/><br/><br/>

</body>
</html>
